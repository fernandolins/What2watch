<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>What2Watch</title>
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href='{{ STATIC_URL }}css/bootstrap.css'>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/base.css">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
  </head>
  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="" class="navbar-brand">What to Watch</a>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">

          <ul class="nav navbar-nav navbar-right">
            <li><button id="login"></button></li>
          </ul>
      
      <div id="fb-root"></div>

      <script src="http://connect.facebook.net/en_US/all.js"></script>
      
      <script>
            // initialize the library with the API key
          FB.init({ appId: '424490127646893',oauth: true});

            // fetch the status on load
          FB.getLoginStatus(handleSessionResponse2);

          $('#login').bind('click', function() {
            console.log("aqui");
            FB.login(handleSessionResponse,{scope: 'email,user_likes'});
          });

          $('#logout').bind('click', function() {
              FB.logout(handleSessionResponse);
          });

          $('#disconnect').bind('click', function() {
              FB.api({ method: 'Auth.revokeAuthorization' }, function(response) {
                clearDisplay();
            });
          });

            // no user, clear display
          function clearDisplay() {
              $('#user-info').hide('fast');
          }

            // handle a session response from any of the auth related calls
          function handleSessionResponse(response) {
              // if we dont have a session, just hide the user info
              if (!(response.status=="connected")) {
                clearDisplay();
                return;
              }

              var data = {}
              data["accessToken"] = response.authResponse.accessToken;
              data["id"] = response.authResponse.userID; 
              console.log(response.authResponse);
              //data["res"] = response;
              //data["resAuth"] = response.authResponse;
              var args = { type:'post', dataType:"json",async:false, url:"{% url 'home' %}", data:data,complete:done, csrfmiddlewaretoken: '{{ csrf_token }}' };
          $.ajax(args);

              // if we have a session, query for the user's profile picture and name
          }

          function handleSessionResponse2(response) {
              // if we dont have a session, just hide the user info
             console.log("apaguei reposnse 2");
          }
          var done2 = function(res, status) {
              console.log("apaguei done2");
          }
            
          var done = function(res, status) {
              if (res.response == "true") {
                var data = {};
                window.location.replace("{% url 'home' %}?"+this.data);
              }
              else{
                console.log("apaguei else")
            //$.ajax(args);
              }
          } 
      </script>
        </div>
      </div>
    </div>
  </body>
</html>